---
const { pageId } = Astro.props as { pageId: string };
---
<style>
  .wrap { display: flex; align-items: center; gap: 1rem; padding: 1.5rem; border: 2px solid var(--sl-color-accent); border-radius: 12px; background: color-mix(in srgb, var(--sl-color-accent) 10%, transparent); margin-top: 2rem; text-align: center; justify-content: center; flex-direction: column; }
  .text { font-weight: 700; font-size: 1.1rem; margin-bottom: 1rem; }
  .btn { background: var(--sl-color-accent); color: white; border: none; border-radius: 8px; padding: .75rem 1.5rem; cursor: pointer; font-weight: 700; font-size: 1rem; transition: opacity .2s; }
  .btn:hover { opacity: .9; }
  .btn:disabled { opacity: .6; cursor: not-allowed; }
  .completed { background: #16a34a; color: white; padding: 1rem; border-radius: 8px; text-align: center; font-weight: 700; margin-top: 1rem; }
</style>
<div class="wrap" dir="rtl" id={`complete-btn-${pageId}`}>
  <div class="text">هل أنهيت هذا الدرس؟</div>
  <button class="btn" id={`btn-complete-${pageId}`} onclick={`completeThisLesson('${pageId}')`}>
    إكمال الدرس
  </button>
  <div class="completed" id={`completed-msg-${pageId}`} style="display:none">✔ تم إكمال هذا الدرس بنجاح!</div>
</div>

<script is:inline define:vars={{ pageId }}>
  window.completeThisLesson = function(id){
    try { localStorage.setItem('progress:' + id, '1'); } catch(e){}
    const btn = document.getElementById('btn-complete-' + id);
    const msg = document.getElementById('completed-msg-' + id);
    if(btn) btn.style.display = 'none';
    if(msg) msg.style.display = 'block';
    try { document.dispatchEvent(new CustomEvent('lesson-completed', { detail: { pageId: id } })); } catch(e){}
  };
  
  (function(){
    const isDone = localStorage.getItem('progress:' + pageId) === '1';
    if(isDone){
      const btn = document.getElementById('btn-complete-' + pageId);
      const msg = document.getElementById('completed-msg-' + pageId);
      if(btn) btn.style.display = 'none';
      if(msg) msg.style.display = 'block';
    }
  })();
</script>
